#!/bin/sh

set -e
METAPHLAN_DB_PATH=./test_input/test_datasets/metaphlan_dbs
OTHER_DATASETS_DIR=./test_input/test_datasets

mkdir -p $METAPHLAN_DB_PATH
mkdir -p $OTHER_DATASETS_DIR

cat <<EOF | sed '/^#/d; /^$/d' | xargs -I {} -n 1 -P 5 sh -c 'echo "Downloading: {}" && wget -c --no-check-certificate --progress=bar:force:noscroll -P "$0" "{}"' "$METAPHLAN_DB_PATH"
# [--metaphlan-index]
# [Metaphlan databases](http://cmprod1.cibio.unitn.it/biobakery4/metaphlan_databases/)

# [mpa_vJun23_CHOCOPhlAnSGB_202307.md5]
http://cmprod1.cibio.unitn.it/biobakery4/metaphlan_databases/mpa_vJun23_CHOCOPhlAnSGB_202307.md5

# [mpa_vJun23_CHOCOPhlAnSGB_202307.tar]
http://cmprod1.cibio.unitn.it/biobakery4/metaphlan_databases/mpa_vJun23_CHOCOPhlAnSGB_202307.tar

# [mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt.bz2]
http://cmprod1.cibio.unitn.it/biobakery4/metaphlan_databases/mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt.bz2

# [mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt.bz2]
http://cmprod1.cibio.unitn.it/biobakery4/metaphlan_databases/mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt.bz2
EOF

cat <<EOF | sed '/^#/d; /^$/d' | xargs -I {} -n 1 -P 5 sh -c 'echo "Downloading: {}" && wget -c --no-check-certificate --progress=bar:force:noscroll -P "$0" "{}"' "$OTHER_DATASETS_DIR"
# [--reference-genome Example] of human index corresponding to version GRCh38
https://genome-idx.s3.amazonaws.com/hisat/grch38_genome.tar.gz
# ================

# [--krakendb] Different databases are provided for kraken2, you can use Minikraken v2 for a fast trial
# [Kraken databases](https://benlangmead.github.io/aws-indexes/k2)
https://genome-idx.s3.amazonaws.com/kraken/minikraken2_v2_8GB_201904.tgz
# ================

# [--protein-db](https://github.com/biobakery/humann?tab=readme-ov-file#download-a-translated-search-database)
# [uniref90_ec_filtered_diamond]
http://huttenhower.sph.harvard.edu/humann_data/uniprot/uniref_ec_filtered/uniref90_annotated_v4_alpha_ec_filtered.tar.gz
# ================

# [--n-db]
# [Humann chocoplan](https://github.com/biobakery/humann?tab=readme-ov-file#download-the-chocophlan-database)
# [EC_FILTERED]
http://huttenhower.sph.harvard.edu/humann_data/chocophlan/chocophlan_EC_FILTERED.v4_alpha.tar.gz
EOF

echo "==> Extracting $OTHER_DATASETS_DIR/grch38_genome.tar.gz into $OTHER_DATASETS_DIR"
tar -xvf $OTHER_DATASETS_DIR/grch38_genome.tar.gz -C $OTHER_DATASETS_DIR
mv $OTHER_DATASETS_DIR/grch38 $OTHER_DATASETS_DIR/grch38_index

echo "==> Extracting $OTHER_DATASETS_DIR/minikraken2_v2_8GB_201904.tgz into $OTHER_DATASETS_DIR"
tar -xvzf $OTHER_DATASETS_DIR/minikraken2_v2_8GB_201904.tgz -C $OTHER_DATASETS_DIR

bunzip2 mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt.bz2
bunzip2 mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt.bz2
tar -xvf mpa_vJun23_CHOCOPhlAnSGB_202307.tar

BEFORE:
13239886 -rw-rw-r-- 1 danielmajer danielmajer   73 Mar 25 20:18 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.md5
13239899 -rw-rw-r-- 1 danielmajer danielmajer 103M Mar 25 20:10 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.tar
13239938 -rw-rw-r-- 1 danielmajer danielmajer 1.7G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt
13240255 -rw-rw-r-- 1 danielmajer danielmajer   70 Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.md5
13271144 -rw-rw-r-- 1 danielmajer danielmajer 6.4M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt
13240258 -rw-rw-r-- 1 danielmajer danielmajer 3.1G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.tar

AFTER:
13239886 -rw-rw-r-- 1 danielmajer danielmajer   73 Mar 25 20:18 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.md5
13239899 -rw-rw-r-- 1 danielmajer danielmajer 103M Mar 25 20:10 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.tar
13239938 -rw-rw-r-- 1 danielmajer danielmajer 1.7G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt
13240255 -rw-rw-r-- 1 danielmajer danielmajer   70 Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.md5
13240257 -rw-rw-r-- 1 danielmajer danielmajer  94M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.pkl
13271203 -rw-rw-r-- 1 danielmajer danielmajer 2.9G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_SGB.fna.bz2
13271144 -rw-rw-r-- 1 danielmajer danielmajer 6.4M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt
13240258 -rw-rw-r-- 1 danielmajer danielmajer 3.1G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.tar
13271206 -rw-rw-r-- 1 danielmajer danielmajer  44K Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_VINFO.csv
13271221 -rw-rw-r-- 1 danielmajer danielmajer 174M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_VSG.fna.bz2

bunzip2 mpa_vJun23_CHOCOPhlAnSGB_202307_VSG.fna.bz2

AFTER:
13239886 -rw-rw-r-- 1 danielmajer danielmajer   73 Mar 25 20:18 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.md5
13239899 -rw-rw-r-- 1 danielmajer danielmajer 103M Mar 25 20:10 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.tar
13239938 -rw-rw-r-- 1 danielmajer danielmajer 1.7G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt
13240255 -rw-rw-r-- 1 danielmajer danielmajer   70 Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.md5
13240257 -rw-rw-r-- 1 danielmajer danielmajer  94M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.pkl
13271203 -rw-rw-r-- 1 danielmajer danielmajer 2.9G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_SGB.fna.bz2
13271144 -rw-rw-r-- 1 danielmajer danielmajer 6.4M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt
13240258 -rw-rw-r-- 1 danielmajer danielmajer 3.1G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.tar
13271206 -rw-rw-r-- 1 danielmajer danielmajer  44K Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_VINFO.csv
13240398 -rw-rw-r-- 1 danielmajer danielmajer 841M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_VSG.fna

bunzip2 mpa_vJun23_CHOCOPhlAnSGB_202307_SGB.fna.bz2

AFTER:
13240253 drwxrwxr-x 6 danielmajer danielmajer 4.0K Apr 23 12:08 ../
13239886 -rw-rw-r-- 1 danielmajer danielmajer   73 Mar 25 20:18 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.md5
13239899 -rw-rw-r-- 1 danielmajer danielmajer 103M Mar 25 20:10 mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.tar
13239938 -rw-rw-r-- 1 danielmajer danielmajer 1.7G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_marker_info.txt
13240255 -rw-rw-r-- 1 danielmajer danielmajer   70 Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.md5
13240257 -rw-rw-r-- 1 danielmajer danielmajer  94M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.pkl
13271223 -rw-rw-r-- 1 danielmajer danielmajer  11G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_SGB.fna
13271144 -rw-rw-r-- 1 danielmajer danielmajer 6.4M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_species.txt
13240258 -rw-rw-r-- 1 danielmajer danielmajer 3.1G Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307.tar
13271206 -rw-rw-r-- 1 danielmajer danielmajer  44K Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_VINFO.csv
13240398 -rw-rw-r-- 1 danielmajer danielmajer 841M Nov 27  2023 mpa_vJun23_CHOCOPhlAnSGB_202307_VSG.fna

tar -xvf mpa_vJun23_CHOCOPhlAnSGB_202307_bt2.tar
